<!DOCTYPE html>
<html class="{{ htmlClass }}" lang="en">
  <head>
    <title>World Campus Design System</title>
    <meta charset="UTF-8">
    <script>
        const cms = {
            attach: (component, callback) => callback(document),
            detach: (component, callback) => callback(document),
            announce: (text, priority) => { /* @todo: implement */ },
            vendor_dir: '/vendor',
            gtm_container_id: 'GTM-TXLS6TM',
            once: (id, selector, context = document) => context.querySelectorAll(selector),
        };
    </script>
    {% include '@psu-ooe/gtm/gtm.twig' %}
    <meta name="viewport" content="width=device-width" />
    {% include '@psu-ooe/webfonts/webfonts.twig' %}

    <!-- Begin Pattern Lab (Required for Pattern Lab to run properly) -->
    {{ patternLabHead | raw }}
    <!-- End Pattern Lab -->
    <link rel="stylesheet" href="../../css/pattern-scaffolding.css?{{ cacheBuster }}" media="all" />

    {# @TODO: Move the visually hidden styles into the base component and stop loading hidden.module.css in Drupal #}
    <style>
      .visually-hidden {
        position: absolute !important;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        width: 1px;
        height: 1px;
        word-wrap: normal;
      }

      .visually-hidden.focusable:active,
      .visually-hidden.focusable:focus {
        position: static !important;
        overflow: visible;
        clip: auto;
        width: auto;
        height: auto;
      }
    </style>

    <style>
      {{ get_component_stylesheets() }}
    </style>
  </head>
  <body class="{{ bodyClass }}">
    {{ get_sprites() }}
  {% set prefs %}
    <div style="text-align: left">
      <h2>User Preferences</h2>
      <form>
        <fieldset>
          <legend>Accent Colors</legend>
          <br>
          <label for="accent-color-decorative--dark">Decorative</label>
          <br>
          <input type="color" name="accent_color_dark" id="accent-color--dark">
          <br>
          <label for="accent-color-decorative--light">Decorative (light)</label>
          <br>
          <input type="color" name="accent_color_light" id="accent-color--light">
          <br>
          <label for="accent-color-interactive--dark">Active</label>
          <br>
          <input type="color" name="accent_color_interactive_dark" id="accent-color-interactive--dark">
          <br>
          <label for="accent-color-interactive--light">Active (light)</label>
          <br>
          <input type="color" name="accent_color_interactive_light" id="accent-color-interactive--light">
        </fieldset>
      </form>
      <script>
        (()=>{
          const prefs = {
            '--accent-color--dark': 'accent_color_dark',
            '--accent-color--light': 'accent_color_light',
            '--accent-color-interactive--dark': 'accent_color_interactive_dark',
            '--accent-color-interactive--light': 'accent_color_interactive_light',
          }
          if (localStorage.getItem('accent_color')) {
            for (const [prop, key] of Object.entries(prefs)) {
              const value = localStorage.getItem(key);
              const elem =  document.querySelector('[name="' + key + '"]');
              elem.value = value;
              elem.addEventListener('change', () => {
                document.documentElement.style.setProperty(prop, elem.value);
                localStorage.setItem(key, elem.value);
                document.documentElement.style.display = 'run-in';
                setTimeout(() => {
                  document.documentElement.style.display = 'block';
                });
              });
              document.documentElement.style.setProperty(prop, value);
              document.documentElement.style.display = 'run-in';
              setTimeout(() => {
                document.documentElement.style.display = 'block';
              });
            }
          }
        })();
      </script>
    </div>
  {% endset %}
  {% set menu %}
    <div style="text-align: right">
      {%  include '@psu-ooe/compact-menu/compact-menu.twig' with {
        menu_label: 'Customize',
        menu: prefs,
      } only %}
    </div>
  {% endset %}
  {% set band %}
    {% include '@psu-ooe/band/band.twig' with {
      padding: 'compact',
      content: menu
    } only %}
  {% endset %}
  {% include '@psu-ooe/sticky-panel/sticky-panel.twig' with {
    bands: [band]
  } only %}
